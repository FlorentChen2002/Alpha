Strapi (Installer)
yarn create strapi-app projet-alpha
cd projet-alpha
yarn install
Supprime les images inutilis√©es : docker system prune -a

docker-compose up -d --build
docker-compose logs -f strapi
/mnt/c/Users/Florent/Music/Opsci/projet_opsci

git clone https://github.com/arthurescriou/opsci-strapi-frontend.git
cd opsci-strapi-frontend
git clone https://github.com/opsci-su/stock-consumer.git
git clone https://github.com/opsci-su/event-producer.git
git clone https://github.com/opsci-su/stock-producer.git
git clone https://github.com/opsci-su/product-producer.git
git clone https://github.com/opsci-su/product-consumer.git
git clone https://github.com/opsci-su/event-consumer.git

docker compose up -d strapi strapiDB react
docker compose up -d zookeeper kafka
docker compose up -d kafka-setup
docker compose up -d product_producer
docker compose up -d event_producer
docker compose up -d stock_producer
docker compose up -d product_consumer event_consumer stock_consumer

 product_producer:
    image: arthurescriou/product-producer:1.0.0
    container_name: product-producer
    build:
      context : ./product-producer
      dockerfile: Dockerfile
    env_file: .env
    environment:
      BROKER_1: ${BROKER_1}
      BROKER_2: ${BROKER_1}
      BROKER_3: ${BROKER_1}
      STRAPI_TOKEN: 1d3bb331446c1d5a7d2c056b5415643340e426e9b35a31e94938dc3874d19632401a21781f30cb5579bb4b442042187a4af8367b16cbeb39e754ffbb0922d5c965386e1980b466169dfd4cfb8cabe293da2bf54e321a040dfd29222dc7e1a498d39f793e673c3a1468e7074e2777d5f06e8458fe7edfe52da5d942b08994221e
      STRAPI_URL: http://strapi:1337
      TOPIC: product
      FILE_NAME: products.csv
      ERROR_TOPIC: errors
    depends_on:
      - kafka
      - kafka-setup
      - strapi
      - stock_consumer
    networks:
      - strapi

  product_consumer:
    image: arthurescriou/product-consumer:latest
    container_name: product-consumer
    build:
      context: ./product-consumer
      dockerfile: Dockerfile
    env_file: .env
    environment:
      BROKER_1: ${BROKER_1}
      BROKER_2: ${BROKER_2}
      BROKER_3: ${BROKER_3}
      STRAPI_TOKEN: 1d3bb331446c1d5a7d2c056b5415643340e426e9b35a31e94938dc3874d19632401a21781f30cb5579bb4b442042187a4af8367b16cbeb39e754ffbb0922d5c965386e1980b466169dfd4cfb8cabe293da2bf54e321a040dfd29222dc7e1a498d39f793e673c3a1468e7074e2777d5f06e8458fe7edfe52da5d942b08994221e
      STRAPI_URL: http://strapi:1337
      TOPIC: product
      ERROR_TOPIC: errors
      BEGINNING: 'false' 
    depends_on:
      - kafka-setup
      - kafka
      - strapi
    networks:
      - strapi

  event_producer:
    image: arthurescriou/event-producer:1.0.3
    container_name: event-producer
    build:
      context : ./event-producer
      dockerfile: Dockerfile 
    env_file: .env
    environment:
      BROKER_1: ${BROKER_1}
      BROKER_2: ${BROKER_2}
      BROKER_3: ${BROKER_3}
      TOPIC: ${EVENT_TOPIC}
      FILE_NAME: ${EVENT_FILE_NAME}
      ERROR_TOPIC: errors
    depends_on:
      - kafka-setup
      - kafka
      - strapi
      - product_producer
    networks:
      - strapi

  event_consumer:
    image: arthurescriou/event-consumer:1.0.0
    container_name: event-consumer
    build:
      context: ./event-consumer
      dockerfile: Dockerfile
    environment:
      BROKER_1: ${BROKER_1}
      BROKER_2: ${BROKER_2}
      BROKER_3: ${BROKER_3}
      STRAPI_URL: ${STRAPI_URL}
      STRAPI_TOKEN: ${REACT_APP_TOKEN}
      TOPIC: event
      BEGINNING: "false"
      ERROR_TOPIC: errors
    depends_on:
      - kafka-setup
      - kafka
      - strapi
      - product_consumer
    networks:
      - strapi

  stock_producer:
    image: arthurescriou/stock-producer:1.0.1
    container_name: stock-producer
    build:
      context: ./stock-producer
      dockerfile: Dockerfile
    env_file: .env
    environment:
      BROKER_1: ${BROKER_1}
      BROKER_2: ${BROKER_2}
      BROKER_3: ${BROKER_3}
      TOPIC: stock
      FILE_NAME: stocks.csv
    depends_on:
      - kafka-setup
      - kafka
      - strapi
      - event_producer
    networks:
      - strapi

  stock_consumer:
    image: arthurescriou/stock-consumer:1.0.0
    container_name: stock-consumer
    build:
      context: ./stock-consumer
      dockerfile: Dockerfile
    env_file: .env
    environment:
      BROKER_1: ${BROKER_1}
      BROKER_2: ${BROKER_2}
      BROKER_3: ${BROKER_3}
      STRAPI_TOKEN: ${STRAPI_TOKEN}
      STRAPI_URL: ${STRAPI_URL}
      TOPIC: stock
      BEGINNING: "false"
      ERROR_TOPIC: errors
    depends_on:
      - kafka-setup
      - kafka
      - strapi
      - event_consumer
    networks:
      - strapi
